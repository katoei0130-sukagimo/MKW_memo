<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MKWorld é“ä¸­ãƒ¡ãƒ¢</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=M+PLUS+Rounded+1c:wght@800;900&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0C0F14;--surf:#141920;--surf2:#1B2330;--surf3:#232f42;
  --bd:rgba(255,255,255,.07);--bd2:rgba(255,255,255,.14);
  --tx:#EEF2FF;--mt:rgba(238,242,255,.44);--mt2:rgba(238,242,255,.22);
  --gold:#F5C842;--gold2:#FDE68A;--red:#E8231A;--green:#4ADE80;
  --r:13px;--r2:9px;
}
html{background:var(--bg);}
body{font-family:'Noto Sans JP','M PLUS Rounded 1c',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;-webkit-font-smoothing:antialiased;overscroll-behavior:none;}
#root{max-width:430px;margin:0 auto;}
.shell{max-width:430px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;background:var(--bg);}
/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.hdr{background:var(--bg);border-bottom:1px solid var(--bd);position:sticky;top:0;z-index:100;}
.hdr-top{display:flex;align-items:center;gap:10px;padding:11px 14px 8px;}
.logo-mark{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--red),#A0100C);display:flex;align-items:center;justify-content:center;font-size:15px;box-shadow:0 0 12px rgba(232,35,26,.4),inset 0 1px 0 rgba(255,255,255,.15);flex-shrink:0;}
.logo-words{flex:1;}
.logo-t{font-family:'M PLUS Rounded 1c',sans-serif;font-size:13px;font-weight:900;background:linear-gradient(90deg,#F5C842,#FDE68A);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.1;}
.logo-s{font-size:9px;color:var(--mt);font-weight:500;letter-spacing:1.5px;text-transform:uppercase;}
.hdr-badge{display:flex;align-items:center;gap:4px;background:rgba(245,200,66,.09);border:1px solid rgba(245,200,66,.2);border-radius:20px;padding:3px 9px;font-size:11px;font-weight:700;color:var(--gold);}
.prog-row{padding:0 14px 5px;display:flex;align-items:center;gap:8px;}
.prog-track{flex:1;height:3px;background:rgba(255,255,255,.05);border-radius:2px;overflow:hidden;}
.prog-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--gold),#FBA55A);transition:width .5s;}
.prog-pct{font-size:10px;color:var(--mt);font-weight:700;}
/* ã‚¿ãƒ– */
.tabs{display:flex;border-bottom:1px solid var(--bd);padding:0 10px;overflow-x:auto;scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab-btn{display:flex;align-items:center;gap:4px;padding:8px 10px;font-family:inherit;font-size:11px;font-weight:700;color:var(--mt);background:none;border:none;border-bottom:2px solid transparent;cursor:pointer;white-space:nowrap;transition:all .2s;position:relative;bottom:-1px;flex-shrink:0;}
.tab-btn:hover{color:var(--tx);}
.tab-btn.on{color:var(--gold);border-bottom-color:var(--gold);}
.tab-n{background:rgba(255,255,255,.06);border-radius:4px;padding:1px 5px;font-size:10px;}
.tab-btn.on .tab-n{background:rgba(245,200,66,.12);color:var(--gold2);}
/* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
.toolbar{padding:10px 14px 8px;display:flex;gap:8px;align-items:center;}
.srch-bar{flex:1;display:flex;align-items:center;background:var(--surf2);border:2px solid var(--bd2);border-radius:12px;overflow:hidden;transition:all .2s;min-width:0;}
.srch-bar:focus-within{border-color:var(--gold);box-shadow:0 0 0 4px rgba(245,200,66,.12);background:rgba(245,200,66,.04);}
.srch-ic{padding:0 8px 0 12px;color:var(--mt);display:flex;align-items:center;flex-shrink:0;font-size:18px;}
.srch-bar:focus-within .srch-ic{color:var(--gold);}
.srch-inp{flex:1;min-width:0;background:none;border:none;outline:none;color:var(--tx);font-family:inherit;font-size:14px;font-weight:500;padding:11px 6px;}
.srch-inp::placeholder{color:var(--mt2);font-weight:400;}
.srch-clr{padding:0 10px;color:var(--mt);background:none;border:none;cursor:pointer;display:flex;align-items:center;opacity:0;pointer-events:none;transition:all .2s;font-size:16px;}
.srch-clr.v{opacity:1;pointer-events:auto;}
.srch-clr:hover{color:var(--red);}
.icon-btn{width:38px;height:38px;border-radius:10px;background:var(--surf2);border:1px solid var(--bd2);color:var(--mt);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;flex-shrink:0;font-size:16px;}
.icon-btn:hover{background:var(--surf3);color:var(--tx);}
.icon-btn.on{background:rgba(245,200,66,.12);border-color:rgba(245,200,66,.35);color:var(--gold);}
/* æ¤œç´¢çµæœã‚«ã‚¦ãƒ³ãƒˆ */
.search-result-count{padding:6px 14px;font-size:11px;color:var(--mt);background:rgba(245,200,66,.05);border-bottom:1px solid rgba(245,200,66,.1);}
.search-result-count strong{color:var(--gold);font-weight:800;}
/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ */
.filter-bar{display:flex;align-items:center;gap:6px;background:rgba(245,200,66,.06);border-bottom:1px solid rgba(245,200,66,.15);padding:6px 14px;}
.filter-txt{flex:1;font-size:11px;font-weight:700;color:var(--gold2);}
.filter-clr{display:flex;align-items:center;gap:3px;background:none;border:1px solid rgba(255,255,255,.08);cursor:pointer;color:var(--mt);font-family:inherit;font-size:11px;padding:3px 7px;border-radius:5px;}
.filter-clr:hover{color:var(--tx);}
/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.cnt{flex:1;overflow-y:auto;padding:8px 12px 84px;}
.cnt::-webkit-scrollbar{width:3px;}
.cnt::-webkit-scrollbar-thumb{background:rgba(245,200,66,.17);border-radius:2px;}
/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.sh{display:flex;align-items:center;gap:7px;padding:9px 2px 5px;}
.sh-dot{width:8px;height:8px;border-radius:50%;}
.sh-name{font-size:11px;font-weight:700;flex:1;}
.sh-cnt{font-size:10px;color:var(--mt);background:rgba(255,255,255,.05);border-radius:4px;padding:1px 5px;font-weight:700;}
.cup-head{display:flex;align-items:center;gap:6px;padding:10px 2px 5px;}
.cup-ico{font-size:14px;}
.cup-name{font-size:11px;font-weight:800;color:var(--mt);}
/* é“ã‚«ãƒ¼ãƒ‰ */
.rc{background:var(--surf);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:5px;cursor:pointer;overflow:hidden;transition:transform .15s,border-color .2s,box-shadow .2s;}
.rc:hover{transform:translateY(-1px);border-color:var(--bd2);box-shadow:0 3px 12px rgba(0,0,0,.22);}
.rc:active{transform:scale(.985);}
.rc-body{display:flex;align-items:center;gap:8px;padding:9px 11px;}
.rc-fdot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.rc-chips{display:flex;align-items:center;gap:5px;flex:1;min-width:0;}
.chip{border-radius:6px;padding:3px 8px;font-size:11px;font-weight:700;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.07);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:130px;}
.rc-arr{color:var(--mt2);flex-shrink:0;font-size:11px;}
.rc-r{display:flex;align-items:center;gap:4px;flex-shrink:0;}
.mdot{width:6px;height:6px;border-radius:50%;background:var(--gold);box-shadow:0 0 5px var(--gold);}
.stic{color:var(--gold);font-size:13px;}
.rc-prev{padding:0 11px 8px 26px;font-size:11px;color:var(--mt);line-height:1.5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
/* é€šå¸¸ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ */
.nc{background:var(--surf);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:5px;cursor:pointer;transition:transform .15s,border-color .2s;}
.nc:hover{transform:translateY(-1px);border-color:var(--bd2);}
.nc:active{transform:scale(.985);}
.nc-body{display:flex;align-items:center;gap:9px;padding:9px 11px;}
.nc-icon{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;}
.nc-info{flex:1;min-width:0;}
.nc-name{font-size:12px;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.nc-cup{font-size:10px;color:var(--mt);margin-top:1px;}
.nc-r{display:flex;align-items:center;gap:4px;flex-shrink:0;}
/* ãŠæ°—ã«å…¥ã‚Šã‚«ãƒ¼ãƒ‰ */
.fav-card{background:var(--surf);border:1px solid rgba(245,200,66,.22);border-radius:var(--r);margin-bottom:5px;cursor:pointer;overflow:hidden;transition:transform .15s,border-color .2s;}
.fav-card:hover{transform:translateY(-1px);border-color:rgba(245,200,66,.38);}
/* è©³ç´°ãƒ“ãƒ¥ãƒ¼ */
.dh{display:flex;align-items:center;gap:9px;padding:10px 13px 9px;border-bottom:1px solid var(--bd);background:var(--bg);position:sticky;top:0;z-index:50;}
.bk{width:32px;height:32px;border-radius:8px;background:var(--surf2);border:1px solid var(--bd);color:var(--tx);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:background .2s;}
.bk:hover{background:var(--surf3);}
.dt-ta{flex:1;min-width:0;}
.dt-ti{font-size:13px;font-weight:800;line-height:1.25;display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.dt-su{font-size:9px;color:var(--mt);margin-top:2px;letter-spacing:.3px;text-transform:uppercase;}
.stb{width:32px;height:32px;border-radius:8px;background:none;border:1px solid var(--bd);cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--mt);transition:all .2s;flex-shrink:0;font-size:16px;}
.stb:hover{border-color:var(--bd2);color:var(--tx);}
.stb.on{background:rgba(245,200,66,.1);border-color:rgba(245,200,66,.3);color:var(--gold);}
.mw{padding:12px 13px;}
.ml{font-size:10px;font-weight:700;letter-spacing:1.2px;color:var(--mt);text-transform:uppercase;margin-bottom:6px;}
.mta{width:100%;min-height:128px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.09);border-radius:10px;padding:10px 12px;color:var(--tx);font-family:inherit;font-size:13px;line-height:1.7;resize:vertical;outline:none;transition:all .2s;}
.mta:focus{border-color:rgba(245,200,66,.38);background:rgba(245,200,66,.03);box-shadow:0 0 0 3px rgba(245,200,66,.06);}
.mta::placeholder{color:var(--mt2);}
.sv-row{display:flex;justify-content:flex-end;margin-top:4px;height:14px;}
.sv{font-size:10px;font-weight:700;transition:color .3s;}
.sv.saving{color:var(--gold);}
.sv.saved{color:var(--green);}
.sv.idle{color:transparent;}
.rw{padding:0 13px 13px;}
.rw-t{font-size:10px;font-weight:700;letter-spacing:1px;color:var(--mt);text-transform:uppercase;margin-bottom:6px;}
.rchips{display:flex;flex-wrap:wrap;gap:5px;}
.rchip{display:flex;align-items:center;gap:5px;background:var(--surf2);border:1px solid var(--bd);border-radius:7px;padding:5px 9px;font-family:inherit;font-size:11px;font-weight:700;color:var(--mt);cursor:pointer;transition:all .15s;}
.rchip:hover{background:rgba(245,200,66,.07);border-color:rgba(245,200,66,.25);color:var(--gold2);}
.rchip-d{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:300;display:flex;align-items:flex-end;justify-content:center;}
.modal{width:100%;max-width:430px;background:var(--surf);border-radius:18px 18px 0 0;max-height:82vh;display:flex;flex-direction:column;overflow:hidden;}
.modal-hdr{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 10px;border-bottom:1px solid var(--bd);}
.modal-title{font-size:14px;font-weight:800;}
.modal-close{width:28px;height:28px;border-radius:7px;background:var(--surf2);border:none;color:var(--mt);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:background .2s;}
.modal-close:hover{background:var(--surf3);color:var(--tx);}
.modal-body{overflow-y:auto;padding:10px 12px 16px;flex:1;}
.modal-body::-webkit-scrollbar{width:3px;}
.modal-body::-webkit-scrollbar-thumb{background:rgba(245,200,66,.15);border-radius:2px;}
/* çµ‚ç‚¹ã‚°ãƒªãƒƒãƒ‰ */
.dest-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;}
.dest-item{display:flex;align-items:center;gap:7px;background:var(--surf2);border:1px solid var(--bd);border-radius:var(--r2);padding:8px 9px;cursor:pointer;transition:all .15s;}
.dest-item:hover{border-color:var(--bd2);}
.dest-item.on{background:rgba(245,200,66,.09);border-color:rgba(245,200,66,.38);}
.dest-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.dest-info{flex:1;min-width:0;}
.dest-name{font-size:11px;font-weight:700;color:var(--mt);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.dest-item.on .dest-name{color:var(--gold2);}
.dest-sub{font-size:9px;color:var(--mt2);margin-top:1px;}
.dest-cnt{font-size:10px;color:var(--mt2);flex-shrink:0;font-weight:700;}
/* ã‚½ãƒ¼ãƒˆãƒªã‚¹ãƒˆ */
.sort-list{display:flex;flex-direction:column;gap:6px;}
.sort-item{display:flex;align-items:center;gap:10px;background:var(--surf2);border:1px solid var(--bd);border-radius:var(--r2);padding:11px 13px;cursor:pointer;transition:all .15s;}
.sort-item:hover{border-color:var(--bd2);}
.sort-item.on{background:rgba(245,200,66,.09);border-color:rgba(245,200,66,.35);}
.sort-ico{font-size:18px;flex-shrink:0;}
.sort-lbl{flex:1;}
.sort-name{font-size:13px;font-weight:700;color:var(--mt);}
.sort-item.on .sort-name{color:var(--gold2);}
.sort-desc{font-size:10px;color:var(--mt2);margin-top:2px;}
.sort-radio{width:18px;height:18px;border-radius:50%;border:2px solid var(--bd2);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;}
.sort-item.on .sort-radio{background:var(--gold);border-color:var(--gold);color:#0C0F14;}
/* ãƒœãƒˆãƒ ãƒŠãƒ“ */
.bn{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:rgba(12,15,20,.97);border-top:1px solid var(--bd);display:flex;padding:7px 0 env(safe-area-inset-bottom,7px);z-index:200;}
.bn-b{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;padding:5px 0;background:none;border:none;cursor:pointer;font-family:inherit;font-size:10px;font-weight:700;color:var(--mt);transition:color .2s;}
.bn-b:hover{color:var(--tx);}
.bn-b.on{color:var(--gold);}
/* empty */
.empty{text-align:center;padding:48px 20px;color:var(--mt);}
.empty-ic{font-size:36px;margin-bottom:10px;}
.empty-tx{font-size:13px;}
/* rainbow */
.rb-bd{border-color:rgba(232,121,249,.3)!important;}
.rb-tx{background:linear-gradient(90deg,#F87171,#FBBF24,#86EFAC,#60A5FA,#E879F9);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
</style>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0C0F14">
</head>
<body>
<div id="root"></div>
<script type="text/babel">

const { useState, useEffect, useCallback, useRef } = React;
const { createClient } = supabase;

const supabaseClient = createClient(
  "https://awyuwywghitoapmnfkcj.supabase.co",
  "sb_publishable_wnNsWbxFMznEDaKX_GyNBg_QXffNxph"
);

useEffect(() => {
  async function testInsert() {
    const { data, error } = await supabaseClient
      .from("memos")
      .insert([{ content: "ãƒ†ã‚¹ãƒˆä¿å­˜" }]);

    console.log("data:", data);
    console.log("error:", error);
  }

  testInsert();
}, []);


// ===== æ­£å¼åç§° =====
const NAME = {
  "DKã†ã¡ã‚…ã†":"DKã†ã¡ã‚…ã†ã‚»ãƒ³ã‚¿ãƒ¼","DKã‚¹ãƒãƒ¼":"DKã‚¹ãƒãƒ¼ãƒã‚¦ãƒ³ãƒ†ãƒ³",
  "ãŠã°ã‘":"ãŠã°ã‘ã‚·ãƒãƒ","ã©ã‚“ãã‚Š":"ã©ã‚“ãã‚Šãƒ„ãƒªãƒ¼ãƒã‚¦ã‚¹",
  "ã¯ã¦ãª":"ãƒãƒ†ãƒŠã—ã‚“ã§ã‚“","ã·ãã·ã":"ãƒ—ã‚¯ãƒ—ã‚¯ãƒ•ã‚©ãƒ¼ãƒ«ã‚º",
  "ã»ã­ã»ã­":"ãƒ›ãƒãƒ›ãƒãƒ„ã‚¤ã‚¹ã‚¿ãƒ¼","ãƒ›ãƒãƒ›ãƒ":"ãƒ›ãƒãƒ›ãƒãƒ„ã‚¤ã‚¹ã‚¿ãƒ¼",
  "ã‚¢ã‚¤ã‚¹":"ã‚¢ã‚¤ã‚¹ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°","ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼":"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",
  "ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—":"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—","ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«":"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",
  "ã‚µãƒ³ã‚µãƒ³":"ã‚µãƒ³ã‚µãƒ³ã•ã°ã","ã‚·ãƒ¥ãƒãƒ":"ã‚·ãƒ¥ãƒãƒã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼",
  "ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼":"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ¼ãƒ‰","ã‚½ãƒ«ãƒ†ã‚£ãƒ¼":"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼ã‚¿ã‚¦ãƒ³",
  "ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³":"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³","ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ":"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒã‚¸ãƒ£ãƒ³ã‚°ãƒ«",
  "ãƒˆãƒ­ãƒ•ã‚£ãƒ¼":"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼ã‚·ãƒ†ã‚£","ãƒã‚³ãƒã‚³":"ãƒã‚³ãƒã‚³ãƒ“ãƒ¼ãƒ",
  "ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ":"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ","ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ":"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",
  "ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«":"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«","ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ":"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",
  "ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ":"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",
  "ãƒ¢ãƒ¼ãƒ¢ãƒ¼":"ãƒ¢ãƒ¼ãƒ¢ãƒ¼ã‚«ãƒ³ãƒˆãƒªãƒ¼","ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰":"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚µãƒ•ã‚¡ãƒª",
  "ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼":"ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ­ãƒ¼ãƒ‰","ãƒ­ã‚¼å¤©":"ãƒ­ã‚¼ãƒƒã‚¿ã¦ã‚“ã‚‚ã‚“ã ã„",
  "ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—":"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—","ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ":"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",
};
const cn = k => NAME[k] || k;

// ===== ã‚«ãƒƒãƒ— =====
const CUPS = [
  {id:"kinoko", icon:"ğŸ„",name:"ã‚­ãƒã‚³ã‚«ãƒƒãƒ—",  courses:["ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ","ãƒˆãƒ­ãƒ•ã‚£ãƒ¼","ã‚·ãƒ¥ãƒãƒ","DKã†ã¡ã‚…ã†"]},
  {id:"flower", icon:"ğŸŒ¸",name:"ãƒ•ãƒ©ãƒ¯ãƒ¼ã‚«ãƒƒãƒ—", courses:["ã‚µãƒ³ã‚µãƒ³","ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«","ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ","ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"]},
  {id:"star",   icon:"â­",name:"ã‚¹ã‚¿ãƒ¼ã‚«ãƒƒãƒ—",   courses:["DKã‚¹ãƒãƒ¼","ãƒ­ã‚¼å¤©","ã‚¢ã‚¤ã‚¹","ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"]},
  {id:"koura",  icon:"ğŸ¢",name:"ã“ã†ã‚‰ã‚«ãƒƒãƒ—",   courses:["ãƒã‚³ãƒã‚³","ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰","ãƒˆãƒ­ãƒ•ã‚£ãƒ¼","ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "]},
  {id:"banana", icon:"ğŸŒ",name:"ãƒãƒŠãƒŠã‚«ãƒƒãƒ—",   courses:["ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ","ã‚½ãƒ«ãƒ†ã‚£ãƒ¼","ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ","ã¯ã¦ãª"]},
  {id:"konoha", icon:"ğŸƒ",name:"ã“ã®ã¯ã‚«ãƒƒãƒ—",   courses:["ã·ãã·ã","ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼","ãŠã°ã‘","ã»ã­ã»ã­"]},
  {id:"thunder",icon:"âš¡",name:"ã‚µãƒ³ãƒ€ãƒ¼ã‚«ãƒƒãƒ—", courses:["ãƒ¢ãƒ¼ãƒ¢ãƒ¼","ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³","ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼","ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"]},
  {id:"special",icon:"ğŸŒˆ",name:"ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚«ãƒƒãƒ—",courses:["ã©ã‚“ãã‚Š","ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ","ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ","ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼"]},
];
const CUP_ORDER = (() => { const s=new Set(),r=[]; CUPS.forEach(c=>c.courses.forEach(x=>{if(!s.has(x)){s.add(x);r.push(x);}})); return r; })();
const AIUEO_ORDER = [...CUP_ORDER].sort((a,b)=>cn(a).localeCompare(cn(b),'ja'));
const getCup = c => CUPS.find(cup=>cup.courses.includes(c));

// ===== è‰² =====
const CC = {
  "DKã†ã¡ã‚…ã†":"#8B5CF6","DKã‚¹ãƒãƒ¼":"#60C8F5","ãŠã°ã‘":"#A78BFA",
  "ã©ã‚“ãã‚Š":"#65A30D","ã¯ã¦ãª":"#FACC15","ã·ãã·ã":"#38BDF8",
  "ã»ã­ã»ã­":"#CBD5E1","ãƒ›ãƒãƒ›ãƒ":"#CBD5E1","ã‚¢ã‚¤ã‚¹":"#67E8F9",
  "ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼":"#94A3B8","ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—":"#64748B","ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«":"#F97316",
  "ã‚µãƒ³ã‚µãƒ³":"#FB923C","ã‚·ãƒ¥ãƒãƒ":"#60A5FA","ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼":"#22D3EE",
  "ã‚½ãƒ«ãƒ†ã‚£ãƒ¼":"#2DD4BF","ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³":"#A8855A","ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ":"#4ADE80",
  "ãƒˆãƒ­ãƒ•ã‚£ãƒ¼":"#FDE047","ãƒã‚³ãƒã‚³":"#F87171","ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ":"#F9A8D4",
  "ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ":"#FDBA74","ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«":"#FCD34D","ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ":"#EF4444",
  "ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ":"#DC2626","ãƒ¢ãƒ¼ãƒ¢ãƒ¼":"#86EFAC","ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰":"#4ADE80",
  "ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼":"#E879F9","ãƒ­ã‚¼å¤©":"#F472B6","ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—":"#FEF08A","ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ":"#FCD34D",
};

// ===== é“ãƒ‡ãƒ¼ã‚¿ 202æœ¬ =====
const ROADS = [
  {f:"ã‚·ãƒ¥ãƒãƒ",t:"DKã†ã¡ã‚…ã†"},{f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"DKã†ã¡ã‚…ã†"},{f:"ãƒã‚³ãƒã‚³",t:"DKã†ã¡ã‚…ã†"},
  {f:"ã‚¢ã‚¤ã‚¹",t:"DKã‚¹ãƒãƒ¼"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"DKã‚¹ãƒãƒ¼"},{f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"DKã‚¹ãƒãƒ¼"},
  {f:"ã·ãã·ã",t:"DKã‚¹ãƒãƒ¼"},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"DKã‚¹ãƒãƒ¼"},{f:"ãƒ­ã‚¼å¤©",t:"DKã‚¹ãƒãƒ¼"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"DKã‚¹ãƒãƒ¼"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ã‚¢ã‚¤ã‚¹"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ã‚¢ã‚¤ã‚¹"},{f:"ãƒ­ã‚¼å¤©",t:"ã‚¢ã‚¤ã‚¹"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"ã‚¢ã‚¤ã‚¹"},
  {f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ãŠã°ã‘"},{f:"ã©ã‚“ãã‚Š",t:"ãŠã°ã‘"},{f:"ãƒ›ãƒãƒ›ãƒ",t:"ãŠã°ã‘"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãŠã°ã‘"},{f:"ãƒ­ã‚¼å¤©",t:"ãŠã°ã‘"},
  {f:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},
  {f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ã©ã‚“ãã‚Š",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},
  {f:"ã»ã­ã»ã­",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},
  {f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼"},
  {f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"},{f:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«",t:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"},
  {f:"ã»ã­ã»ã­",t:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—"},
  {f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},{f:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},
  {f:"ã»ã­ã»ã­",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«"},
  {f:"DKã†ã¡ã‚…ã†",t:"ã‚µãƒ³ã‚µãƒ³"},{f:"ã‚·ãƒ¥ãƒãƒ",t:"ã‚µãƒ³ã‚µãƒ³"},{f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ã‚µãƒ³ã‚µãƒ³"},{f:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«",t:"ã‚µãƒ³ã‚µãƒ³"},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚µãƒ³ã‚µãƒ³"},
  {f:"DKã†ã¡ã‚…ã†",t:"ã‚·ãƒ¥ãƒãƒ"},{f:"ã‚µãƒ³ã‚µãƒ³",t:"ã‚·ãƒ¥ãƒãƒ"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ã‚·ãƒ¥ãƒãƒ"},{f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ã‚·ãƒ¥ãƒãƒ"},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚·ãƒ¥ãƒãƒ"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ã‚¢ã‚¤ã‚¹",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ãŠã°ã‘",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},
  {f:"ã©ã‚“ãã‚Š",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ã·ãã·ã",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},{f:"ãƒ­ã‚¼å¤©",t:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ã‚¢ã‚¤ã‚¹",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ã¯ã¦ãª",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},
  {f:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ã·ãã·ã",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼"},
  {f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ã‚·ãƒ¥ãƒãƒ",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},
  {f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ã·ãã·ã",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},
  {f:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³"},
  {f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ"},{f:"ãƒã‚³ãƒã‚³",t:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ"},{f:"ã¯ã¦ãª",t:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ"},{f:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",t:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ"},
  {f:"DKã†ã¡ã‚…ã†",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ã‚µãƒ³ã‚µãƒ³",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ã‚·ãƒ¥ãƒãƒ",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},
  {f:"ãƒã‚³ãƒã‚³",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},
  {f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼"},
  {f:"ãŠã°ã‘",t:"ã©ã‚“ãã‚Š"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ã©ã‚“ãã‚Š"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ã©ã‚“ãã‚Š"},{f:"ã»ã­ã»ã­",t:"ã©ã‚“ãã‚Š"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã©ã‚“ãã‚Š"},
  {f:"DKã†ã¡ã‚…ã†",t:"ãƒã‚³ãƒã‚³"},{f:"ã‚µãƒ³ã‚µãƒ³",t:"ãƒã‚³ãƒã‚³"},{f:"ã‚·ãƒ¥ãƒãƒ",t:"ãƒã‚³ãƒã‚³"},{f:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ",t:"ãƒã‚³ãƒã‚³"},
  {f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒã‚³ãƒã‚³"},{f:"ã¯ã¦ãª",t:"ãƒã‚³ãƒã‚³"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒã‚³ãƒã‚³"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ãƒã‚³ãƒã‚³"},
  {f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ã¯ã¦ãª"},{f:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ",t:"ã¯ã¦ãª"},{f:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",t:"ã¯ã¦ãª"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ã¯ã¦ãª"},
  {f:"DKã†ã¡ã‚…ã†",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
  {f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒã‚³ãƒã‚³",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ã·ãã·ã",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
  {f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
  {f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ"},{f:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ",t:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ"},{f:"ã¯ã¦ãª",t:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ"},{f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ã·ãã·ã"},{f:"ã‚¢ã‚¤ã‚¹",t:"ã·ãã·ã"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ã·ãã·ã"},{f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ã·ãã·ã"},
  {f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ã·ãã·ã"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã·ãã·ã"},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ã·ãã·ã"},
  {f:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰",t:"ã·ãã·ã"},{f:"ãƒ­ã‚¼å¤©",t:"ã·ãã·ã"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"ã·ãã·ã"},
  {f:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—",t:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«"},{f:"ã‚µãƒ³ã‚µãƒ³",t:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«"},
  {f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«"},
  {f:"ãŠã°ã‘",t:"ã»ã­ã»ã­"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ã»ã­ã»ã­"},{f:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—",t:"ã»ã­ã»ã­"},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ã»ã­ã»ã­"},
  {f:"ã©ã‚“ãã‚Š",t:"ã»ã­ã»ã­"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ã»ã­ã»ã­"},{f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ã»ã­ã»ã­"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ã»ã­ã»ã­"},
  {f:"ãŠã°ã‘",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã©ã‚“ãã‚Š",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã»ã­ã»ã­",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ãƒ­ã‚¼å¤©",t:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"DKã†ã¡ã‚…ã†",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"ã‚µãƒ³ã‚µãƒ³",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ã‚·ãƒ¥ãƒãƒ",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},{f:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},
  {f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ã·ãã·ã",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ã»ã­ã»ã­",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒ¢ãƒ¼ãƒ¢ãƒ¼"},
  {f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ãƒ‡ã‚£ãƒãƒ‡ã‚£ãƒ",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ãƒã‚³ãƒã‚³",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},
  {f:"ã¯ã¦ãª",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},{f:"ã·ãã·ã",t:"ãƒªãƒãƒ¼ã‚µã‚¤ãƒ‰"},
  {f:"ãƒ”ãƒ¼ãƒã‚¹ã‚¿ã‚¸ã‚¢ãƒ ",t:"ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ãƒ­ã‚¼å¤©"},{f:"ã‚¢ã‚¤ã‚¹",t:"ãƒ­ã‚¼å¤©"},{f:"ãŠã°ã‘",t:"ãƒ­ã‚¼å¤©"},{f:"ã‚·ãƒ§ãƒ¼ãƒ‹ãƒ¥ãƒ¼",t:"ãƒ­ã‚¼å¤©"},
  {f:"ã·ãã·ã",t:"ãƒ­ã‚¼å¤©"},{f:"ãƒãƒªã‚ªã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒ­ã‚¼å¤©"},{f:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—",t:"ãƒ­ã‚¼å¤©"},
  {f:"DKã‚¹ãƒãƒ¼",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},{f:"ã‚¢ã‚¤ã‚¹",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},{f:"ã‚½ãƒ«ãƒ†ã‚£ãƒ¼",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},
  {f:"ãƒ”ãƒ¼ãƒãƒ“ãƒ¼ãƒ",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},{f:"ã·ãã·ã",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},{f:"ãƒ­ã‚¼å¤©",t:"ãƒ¯ãƒªã‚ªã‚·ãƒƒãƒ—"},
  {f:"ã‚­ãƒãƒ”ã‚ªãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ã‚­ãƒ©ãƒ¼ã‚·ãƒƒãƒ—",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ã‚¯ãƒƒãƒ‘ã‚­ãƒ£ãƒƒã‚¹ãƒ«",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
  {f:"ãƒãƒ§ã‚³ãƒã‚¦ãƒ³ãƒ†ãƒ³",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒˆãƒ­ãƒ•ã‚£ãƒ¼",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒ˜ã‚¤ãƒ›ãƒ¼ã‚«ãƒ¼ãƒ‹ãƒãƒ«",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
  {f:"ãƒ›ãƒãƒ›ãƒ",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},{f:"ãƒãƒªã‚ªãƒ–ãƒ©ã‚¶ãƒ¼ã‚ºã‚µãƒ¼ã‚­ãƒƒãƒˆ",t:"ãƒ¯ãƒªã‚ªã‚¹ã‚¿ã‚¸ã‚¢ãƒ "},
];

// Storageï¼ˆlocalStorageä½¿ç”¨ï¼‰
const USER_ID = "shared-memo"; // å…¨ç«¯æœ«å…±é€š

async function loadData() {
  const { data } = await window.supabase
    .from("memos")
    .select("content")
    .eq("id", USER_ID)
    .single();

  return data ? JSON.parse(data.content) : {};
}

async function saveData(d) {
  await window.supabase
    .from("memos")
    .upsert({
      id: USER_ID,
      content: JSON.stringify(d)
    });
}

const rk=(f,t)=>`r:${f}>${t}`;
const nk=c=>`n:${c}`;
const sk=id=>`s:${id}`;

// ===== NormalCard =====
function NormalCard({course, data, onOpen, highlight}) {
  const key=nk(course), has=!!(data[key]?.trim()), star=!!data[sk(key)], isRb=course==="ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼", cup=getCup(course);
  const courseName = cn(course);
  const displayName = highlight && courseName.includes(highlight) 
    ? courseName.split(highlight).reduce((acc, part, i) => 
        i === 0 ? [part] : [...acc, <mark key={i} style={{background:'var(--gold)',color:'var(--bg)',padding:'1px 2px',borderRadius:2}}>{highlight}</mark>, part], [])
    : courseName;
  return (
    <div className={`nc${isRb?" rb-bd":""}`} style={{borderColor:(CC[course]||"#888")+"30"}} onClick={()=>onOpen(course)}>
      <div className="nc-body">
        <div className="nc-icon" style={{background:(CC[course]||"#888")+"22",color:CC[course]||"var(--tx)"}}>{cup?.icon||"ğŸ"}</div>
        <div className="nc-info">
          <div className={`nc-name${isRb?" rb-tx":""}`} style={isRb?{}:{color:CC[course]||"var(--tx)"}}>{displayName}</div>
          {cup&&<div className="nc-cup">{cup.name}</div>}
        </div>
        <div className="nc-r">{star&&<span className="stic">â˜…</span>}{has&&<span className="mdot"/>}</div>
      </div>
    </div>
  );
}

// ===== RoadCard =====
function RoadCard({f, t, data, onOpen, isFav}) {
  const key=rk(f,t), has=!!(data[key]?.trim()), star=!!data[sk(key)], isRb=t==="ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼";
  return (
    <div className={`${isFav?"fav-card":"rc"}${isRb?" rb-bd":""}`} onClick={()=>onOpen(f,t)}>
      <div className="rc-body">
        <span className="rc-fdot" style={{background:CC[f]||"#888",boxShadow:`0 0 4px ${CC[f]||"#888"}88`}}/>
        <div className="rc-chips">
          <div className="chip" style={{color:CC[f]||"var(--tx)",borderColor:(CC[f]||"#888")+"28"}}>{cn(f)}</div>
          <span className="rc-arr">â†’</span>
          <div className="chip" style={{color:CC[t]||"var(--tx)",borderColor:(CC[t]||"#888")+"28"}}>{cn(t)}</div>
        </div>
        <div className="rc-r">{star&&<span className="stic">â˜…</span>}{has&&<span className="mdot"/>}</div>
      </div>
      {has&&<div className="rc-prev">{data[key]}</div>}
    </div>
  );
}

// ===== Main App =====
function App() {
  const [tab, setTab]         = useState("roads");
  const [data, setData]       = useState(() => loadData());
  const [detail, setDetail]   = useState(null);
  const [q, setQ]             = useState("");
  const [destFilter, setDestF]= useState(null);
  const [sortMode, setSort]   = useState("cup");
  const [showDest, setShowDest] = useState(false);
  const [showSort, setShowSort] = useState(false);
  const [svSt, setSvSt]       = useState("idle");
  const svTmr = useRef(null);
  const inpRef = useRef(null);

  const upMemo = useCallback((key, val) => {
    setData(prev => {
      const nx = {...prev, [key]: val};
      if (svTmr.current) clearTimeout(svTmr.current);
      setSvSt("saving");
      svTmr.current = setTimeout(() => { saveData(nx); setSvSt("saved"); setTimeout(()=>setSvSt("idle"),1400); }, 600);
      return nx;
    });
  }, []);

  const togStar = useCallback((key) => {
    setData(prev => { const nx={...prev,[sk(key)]:!prev[sk(key)]}; saveData(nx); return nx; });
  }, []);

  const memoCnt = Object.entries(data).filter(([k,v])=>!k.startsWith("s:")&&v?.trim()).length;
  const pct = Math.round(memoCnt/232*100);

  const filtered = ROADS.filter(r => (!destFilter||r.t===destFilter) && (!q||cn(r.f).includes(q)||cn(r.t).includes(q)));
  const byDest = {};
  filtered.forEach(r=>{ (byDest[r.t]=byDest[r.t]||[]).push(r.f); });
  const sortedDests = Object.keys(byDest).sort((a,b)=>cn(a).localeCompare(cn(b),'ja'));

  const courseOrder = sortMode==="cup" ? CUP_ORDER : AIUEO_ORDER;
  const filtNorm = courseOrder.filter(c=>!q||cn(c).includes(q));
  const favRoads = ROADS.filter(r=>data[sk(rk(r.f,r.t))]);

  const switchTab = t => { setTab(t); setDestF(null); setQ(""); setTimeout(()=>inpRef.current?.focus(),100); };

  // é“è©³ç´°
  if (detail?.type==="road") {
    const {f,t}=detail, key=rk(f,t), memo=data[key]||"", starred=!!data[sk(key)];
    const othFr=ROADS.filter(r=>r.t===t&&r.f!==f).map(r=>r.f).sort((a,b)=>cn(a).localeCompare(cn(b),'ja'));
    const othTo=ROADS.filter(r=>r.f===f&&r.t!==t).map(r=>r.t).sort((a,b)=>cn(a).localeCompare(cn(b),'ja'));
    return (
      <div className="shell">
        <div className="dh">
          <button className="bk" onClick={()=>setDetail(null)}>â†</button>
          <div className="dt-ta">
            <div className="dt-ti">
              <span style={{color:CC[f]||"#aaa"}}>{cn(f)}</span>
              <span style={{color:"var(--mt2)",margin:"0 3px"}}>â†’</span>
              <span style={{color:CC[t]||"#aaa"}}>{cn(t)}</span>
            </div>
            <div className="dt-su">é“ãƒ¡ãƒ¢</div>
          </div>
          <button className={`stb${starred?" on":""}`} onClick={()=>togStar(key)}>{starred?"â˜…":"â˜†"}</button>
        </div>
        <div className="cnt">
          <div className="mw">
            <div className="ml">ãƒ¡ãƒ¢</div>
            <textarea className="mta" placeholder={`${cn(f)} â†’ ${cn(t)} ã®é“ã«ã¤ã„ã¦ãƒ¡ãƒ¢â€¦`}
              value={memo} onChange={e=>upMemo(key,e.target.value)} rows={6} autoFocus/>
            <div className="sv-row"><span className={`sv ${svSt}`}>{svSt==="saving"?"ğŸ’¾ ä¿å­˜ä¸­â€¦":svSt==="saved"?"âœ… ä¿å­˜æ¸ˆã¿":""}</span></div>
          </div>
          {othFr.length>0&&<div className="rw"><div className="rw-t">â†³ {cn(t)} ã«å‘ã‹ã†ä»–ã®é“</div><div className="rchips">{othFr.map(c=><button key={c} className="rchip" onClick={()=>setDetail({type:"road",f:c,t})}><span className="rchip-d" style={{background:CC[c]||"#888"}}/>{cn(c)}</button>)}</div></div>}
          {othTo.length>0&&<div className="rw"><div className="rw-t">â†— {cn(f)} ã‹ã‚‰å‡ºã‚‹ä»–ã®é“</div><div className="rchips">{othTo.map(c=><button key={c} className="rchip" onClick={()=>setDetail({type:"road",f,t:c})}><span className="rchip-d" style={{background:CC[c]||"#888"}}/>{cn(c)}</button>)}</div></div>}
        </div>
      </div>
    );
  }

  // é€šå¸¸ã‚³ãƒ¼ã‚¹è©³ç´°
  if (detail?.type==="normal") {
    const {course}=detail, key=nk(course), memo=data[key]||"", starred=!!data[sk(key)], isRb=course==="ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼", cup=getCup(course);
    return (
      <div className="shell">
        <div className="dh">
          <button className="bk" onClick={()=>setDetail(null)}>â†</button>
          <div className="dt-ta">
            <div className={`dt-ti${isRb?" rb-tx":""}`} style={isRb?{}:{color:CC[course]||"var(--tx)"}}>{cup?.icon} {cn(course)}</div>
            <div className="dt-su">{cup?.name} â€” ãƒ¡ãƒ¢</div>
          </div>
          <button className={`stb${starred?" on":""}`} onClick={()=>togStar(key)}>{starred?"â˜…":"â˜†"}</button>
        </div>
        <div className="cnt">
          <div className="mw">
            <div className="ml">ãƒ¡ãƒ¢</div>
            <textarea className="mta" placeholder={`${cn(course)} ã®æ”»ç•¥ãƒ¡ãƒ¢â€¦`}
              value={memo} onChange={e=>upMemo(key,e.target.value)} rows={8} autoFocus/>
            <div className="sv-row"><span className={`sv ${svSt}`}>{svSt==="saving"?"ğŸ’¾ ä¿å­˜ä¸­â€¦":svSt==="saved"?"âœ… ä¿å­˜æ¸ˆã¿":""}</span></div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="shell">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="hdr">
        <div className="hdr-top">
          <div className="logo-mark">ğŸï¸</div>
          <div className="logo-words">
            <div className="logo-t">MKWorld é“ä¸­ãƒ¡ãƒ¢</div>
            <div className="logo-s">Mario Kart World</div>
          </div>
          <div className="hdr-badge">{memoCnt}/232 <span style={{color:"var(--mt)",marginLeft:2}}>è¨˜éŒ²</span></div>
        </div>
        <div className="prog-row">
          <div className="prog-track"><div className="prog-fill" style={{width:`${pct}%`}}/></div>
          <div className="prog-pct">{pct}%</div>
        </div>
        <div className="tabs">
          <button className={`tab-btn${tab==="roads"?" on":""}`} onClick={()=>switchTab("roads")}>ğŸ›£ é“<span className="tab-n">202</span></button>
          <button className={`tab-btn${tab==="normal"?" on":""}`} onClick={()=>switchTab("normal")}>ğŸ é€šå¸¸ã‚³ãƒ¼ã‚¹<span className="tab-n">30</span></button>
          <button className={`tab-btn${tab==="favs"?" on":""}`} onClick={()=>switchTab("favs")}>â˜… ãŠæ°—ã«å…¥ã‚Š<span className="tab-n">{favRoads.length}</span></button>
        </div>
        <div className="toolbar">
          <div className="srch-bar">
            <div className="srch-ic">ğŸ”</div>
           <input 
  ref={inpRef}
  className="srch-inp"
  placeholder={
    tab==="roads"?"ã‚³ãƒ¼ã‚¹åã§æ¤œç´¢":
    tab==="normal"?"ã‚³ãƒ¼ã‚¹åã§æ¤œç´¢":
    "ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰æ¤œç´¢â€¦"
  }
  value={q}
  onChange={e=>setQ(e.target.value)}
  autoComplete="off"
  autoCorrect="off"
  autoCapitalize="off"
  spellCheck="false"
/>
            <button className={`srch-clr${q?" v":""}`} onClick={()=>{setQ("");inpRef.current?.focus();}}>âœ•</button>
          </div>
          {tab==="roads"&&<button className={`icon-btn${destFilter?" on":""}`} onClick={()=>setShowDest(true)} title="çµ‚ç‚¹ã§çµè¾¼">â–¼</button>}
          {tab==="normal"&&<button className="icon-btn" onClick={()=>setShowSort(true)} title="ä¸¦ã³æ›¿ãˆ">â‰¡</button>}
        </div>
        {q&&tab==="roads"&&<div className="search-result-count">æ¤œç´¢çµæœ: <strong>{filtered.length}æœ¬ã®é“</strong>{destFilter&&` (çµ‚ç‚¹: ${cn(destFilter)})`}</div>}
        {q&&tab==="normal"&&<div className="search-result-count">æ¤œç´¢çµæœ: <strong>{filtNorm.length}ã‚³ãƒ¼ã‚¹</strong></div>}
        {q&&tab==="favs"&&<div className="search-result-count">æ¤œç´¢çµæœ: <strong>{favRoads.filter(r=>!q||cn(r.f).includes(q)||cn(r.t).includes(q)).length}ä»¶</strong></div>}
        {tab==="roads"&&destFilter&&(
          <div className="filter-bar">
            <div className="filter-txt">çµ‚ç‚¹ï¼š<span style={{color:CC[destFilter]||"#aaa"}}>{cn(destFilter)}</span><span style={{color:"var(--mt)",marginLeft:5}}>ï¼ˆ{filtered.length}æœ¬ï¼‰</span></div>
            <button className="filter-clr" onClick={()=>setDestF(null)}>âœ• è§£é™¤</button>
          </div>
        )}
      </div>

      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
      <div className="cnt">
        {/* é“ã‚¿ãƒ– */}
        {tab==="roads"&&(filtered.length===0
          ?<div className="empty"><div className="empty-ic">ğŸ”</div><div className="empty-tx">{q?`ã€Œ${q}ã€ã«ä¸€è‡´ã™ã‚‹é“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`:"é“ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„"}</div>{q&&<div style={{fontSize:11,color:"var(--mt)",marginTop:8}}>åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è©¦ã™ã‹ã€çµ‚ç‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è§£é™¤ã—ã¦ãã ã•ã„</div>}</div>
          :sortedDests.map(d=>(
            <div key={d}>
              <div className="sh">
                <span className="sh-dot" style={{background:CC[d]||"#888",boxShadow:`0 0 5px ${CC[d]||"#888"}55`}}/>
                <span className="sh-name" style={{color:CC[d]||"var(--tx)"}}>â†’ {cn(d)}</span>
                <span className="sh-cnt">{byDest[d].length}æœ¬</span>
              </div>
              {[...byDest[d]].sort((a,b)=>cn(a).localeCompare(cn(b),'ja')).map(f=>(
                <RoadCard key={f} f={f} t={d} data={data} onOpen={(f,t)=>setDetail({type:"road",f,t})}/>
              ))}
            </div>
          ))
        )}

        {/* é€šå¸¸ã‚³ãƒ¼ã‚¹ã‚¿ãƒ– */}
        {tab==="normal"&&(filtNorm.length===0
          ?<div className="empty"><div className="empty-ic">ğŸ”</div><div className="empty-tx">ã€Œ{q}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div></div>
          :sortMode==="cup"
            ?CUPS.map(cup=>{
                const cc=cup.courses.filter(c=>filtNorm.includes(c));
                if(!cc.length)return null;
                return(<div key={cup.id}><div className="cup-head"><span className="cup-ico">{cup.icon}</span><span className="cup-name">{cup.name}</span></div>{cc.map(c=><NormalCard key={c} course={c} data={data} onOpen={c=>setDetail({type:"normal",course:c})} highlight={q}/>)}</div>);
              })
            :filtNorm.map(c=><NormalCard key={c} course={c} data={data} onOpen={c=>setDetail({type:"normal",course:c})} highlight={q}/>)
        )}

        {/* ãŠæ°—ã«å…¥ã‚Šã‚¿ãƒ– */}
        {tab==="favs"&&(favRoads.length===0
          ?<div className="empty"><div className="empty-ic">â­</div><div className="empty-tx">é“ã«ã‚¹ã‚¿ãƒ¼â˜…ã‚’ä»˜ã‘ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div></div>
          :(()=>{
            const shown=favRoads.filter(r=>!q||cn(r.f).includes(q)||cn(r.t).includes(q));
            if(!shown.length)return<div className="empty"><div className="empty-ic">ğŸ”</div><div className="empty-tx">ã€Œ{q}ã€ã®ãŠæ°—ã«å…¥ã‚ŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div></div>;
            return shown.map(r=><RoadCard key={rk(r.f,r.t)} f={r.f} t={r.t} data={data} onOpen={(f,t)=>setDetail({type:"road",f,t})} isFav/>);
          })()
        )}
      </div>

      {/* ãƒœãƒˆãƒ ãƒŠãƒ“ */}
      <div className="bn">
        <button className={`bn-b${tab==="roads"?" on":""}`} onClick={()=>switchTab("roads")}>ğŸ›£<br/>é“ (202)</button>
        <button className={`bn-b${tab==="normal"?" on":""}`} onClick={()=>switchTab("normal")}>ğŸ<br/>é€šå¸¸ (30)</button>
        <button className={`bn-b${tab==="favs"?" on":""}`} onClick={()=>switchTab("favs")}>â˜…<br/>ãŠæ°—ã«å…¥ã‚Š ({favRoads.length})</button>
      </div>

      {/* çµ‚ç‚¹é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {showDest&&(
        <div className="overlay" onClick={()=>setShowDest(false)}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className="modal-hdr">
              <div className="modal-title">çµ‚ç‚¹ã‚’é¸ã‚“ã§çµè¾¼</div>
              <button className="modal-close" onClick={()=>setShowDest(false)}>âœ•</button>
            </div>
            <div className="modal-body">
              <div className="dest-grid">
                {[...CUP_ORDER].sort((a,b)=>cn(a).localeCompare(cn(b),'ja')).map(c=>{
                  const cup=getCup(c), count=ROADS.filter(r=>r.t===c).length;
                  return(
                    <div key={c} className={`dest-item${destFilter===c?" on":""}`}
                      onClick={()=>{setDestF(destFilter===c?null:c);setShowDest(false);}}>
                      <span className="dest-dot" style={{background:CC[c]||"#888"}}/>
                      <div className="dest-info">
                        <div className="dest-name">{cn(c)}</div>
                        <div className="dest-sub">{cup?.icon} {cup?.name}</div>
                      </div>
                      <div className="dest-cnt">{count}</div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* ã‚½ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« */}
      {showSort&&(
        <div className="overlay" onClick={()=>setShowSort(false)}>
          <div className="modal" onClick={e=>e.stopPropagation()}>
            <div className="modal-hdr">
              <div className="modal-title">ä¸¦ã³æ›¿ãˆ</div>
              <button className="modal-close" onClick={()=>setShowSort(false)}>âœ•</button>
            </div>
            <div className="modal-body">
              <div className="sort-list">
                {[{id:"cup",icon:"ğŸ†",name:"ã‚«ãƒƒãƒ—é †",desc:"ã‚­ãƒã‚³â†’ãƒ•ãƒ©ãƒ¯ãƒ¼â†’ã‚¹ã‚¿ãƒ¼â€¦ã®é †"},{id:"aiueo",icon:"ğŸ”¤",name:"ã‚ã„ã†ãˆãŠé †",desc:"æ­£å¼åç§°ã§ã‚ã„ã†ãˆãŠé †"}].map(s=>(
                  <div key={s.id} className={`sort-item${sortMode===s.id?" on":""}`} onClick={()=>{setSort(s.id);setShowSort(false);}}>
                    <div className="sort-ico">{s.icon}</div>
                    <div className="sort-lbl"><div className="sort-name">{s.name}</div><div className="sort-desc">{s.desc}</div></div>
                    <div className="sort-radio">{sortMode===s.id&&"âœ“"}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script><script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://awyuwywghitoapmnfkcj.supabase.co",
  "sb_publishable_wnNsWbxFMznEDaKX_GyNBg_QXffNxph"
);

window.supabase = supabase;

console.log("ğŸ”¥ Supabase connected");
</script>

</body>
</html>









